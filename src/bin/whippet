#!/usr/bin/env node

var path = require('path'),
	fs = require('fs');

// path to the js file
var lib = fs.realpathSync(__filename);
lib = path.dirname( lib );
lib = path.join( lib, '../lib' );


var frd = require( lib + '/whippet/filer.js' );
var whippet = require( lib + '/whippet.js');

// NEW
if ( process.argv.length > 3 && process.argv[2] === 'new' ){

	var newsitedir = process.argv[3];	
	
	var cwd = process.cwd();
	cwd += '/' + newsitedir;		
	
	frd.copy( lib + '/structure-template', cwd, function(err){
		console.log( 'New site created' );
	} );

}


// BUILD
if ( process.argv.length > 2 && process.argv[2] === 'build' ){
	whippet.whip();
	console.log( 'Site re-built' );
}


// WATCH
if ( process.argv.length > 2 && process.argv[2] === 'watch' ){
	console.log( 'watching over your site' );
	
	var cwd = process.cwd();

	var fileList = fs.readdirSync( '.' );
	var filesToWatch = [];
		
	for( var i = 0; i < fileList.length; i++ ){		
		
		if ( fileList[i].search('site') === -1 && fileList[i][0] !== '.' ){
		
			if ( fs.statSync( fileList[i] ).isDirectory() ) filesToWatch.push( cwd + '/' + fileList[i] );
		}
	}
	
	frd.watch( cwd, cwd + '/site', function(){
		console.log( 'Updating site' );
		whippet.whip();
	} );
	
}